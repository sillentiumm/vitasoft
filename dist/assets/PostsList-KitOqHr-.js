import{r as g,o as V,c as l,d as n,e as r,f as C,b as x,v as P,g as i,i as S,t as u,h as $,m as U,s as A,q as E,a as L,F as R,j,u as H,p as q,k as T,n as O,l as z}from"./index-B0BkaikO.js";import{_ as w,u as G,a as B,I as J}from"./IconAvatar-DnJJ8yi9.js";const K={class:"wrapper"},Q={key:0,class:"error"},W={key:0,class:"error"},X={key:0,class:"error"},Y={__name:"PostCreate",props:{userId:{type:String,default:null}},emits:["close"],setup(b,{emit:k}){const y=b,D=k,{handleSubmit:f,errors:o,defineField:v}=G({validateOnMount:!1,validationSchema:{title(s){return s?s.length>50?"Максимальное длина названия - 100 символов":!0:"Введите название"},briefDescription(s){return s?s.length>100?"Максимальное длина - 100 символов":!0:"Введите описание"},fullDescription(s){return s?s.length>255?"Максимальное длина - 100 символов":!0:"Введите описание"}}}),[d]=v("title"),[h]=v("briefDescription"),[c]=v("fullDescription"),_=g(null),N=g(null),p=(s,t)=>{const e=t==="textarea1"?_:N;e.value&&(e.value.style.height="auto",e.value.style.height=e.value.scrollHeight+"px")},a=f(s=>{const t="/api/post",e={title:d.value,briefDescription:h.value,fullDescription:c.value},m={params:{userInfoId:y.userId}};return B.post(t,e,m).then(I=>{if(D("close"),I.data)return I.data}).catch(I=>{console.log("Ошибка при создании записи")})});return V(()=>{p(null,"textarea1"),p(null,"textarea2")}),(s,t)=>(n(),l("div",K,[r("form",{onSubmit:t[6]||(t[6]=$((...e)=>i(a)&&i(a)(...e),["prevent"])),action:""},[t[7]||(t[7]=r("h3",null,null,-1)),t[8]||(t[8]=r("h3",null,"Создание поста",-1)),r("div",null,[C(r("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>S(d)?d.value=e:null),placeholder:"Заголовок",type:"text"},null,512),[[P,i(d)]]),i(o).title?(n(),l("span",Q,u(i(o).title),1)):x("",!0)]),r("div",null,[C(r("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>S(h)?h.value=e:null),onInput:t[2]||(t[2]=e=>p(e,"textarea1")),ref_key:"textarea1",ref:_,placeholder:"Краткое описание"},null,544),[[P,i(h)]]),i(o).briefDescription?(n(),l("span",W,u(i(o).briefDescription),1)):x("",!0)]),r("div",null,[C(r("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>S(c)?c.value=e:null),onInput:t[4]||(t[4]=e=>p(e,"textarea2")),ref_key:"textarea2",ref:N,placeholder:"Полное описание"},null,544),[[P,i(c)]]),i(o).fullDescription?(n(),l("span",X,u(i(o).fullDescription),1)):x("",!0)]),t[9]||(t[9]=r("button",null,"создать пост",-1)),r("div",{onClick:t[5]||(t[5]=e=>D("close")),class:"close"},"×")],32)]))}},Z=w(Y,[["__scopeId","data-v-be7230a3"]]),ee={class:"wrapper"},te={key:1},se={key:2},re={class:"postslist"},ne=["onClick"],oe={key:0},le={key:1},ae={__name:"PostsList",props:{userId:{type:String,default:null}},setup(b){const k=b,y=H(),D=E(),f=U([]),o=g(!1),v=g(!1),d=g(null),h=A(()=>{if(!v)return[];let a=f;return k.userId&&(a=f.filter(s=>s.userInfoId===Number(D.params.id))),[...a].sort((s,t)=>{const e=c(s.dateTime);return c(t.dateTime)-e})}),c=a=>{const[s,t]=a.split(" "),[e,m,I]=s.split("-").map(Number),[F,M]=t.split(":").map(Number);return new Date(I,m-1,e,F,M)},_=a=>{y.push({name:"post",params:{id:a}})},N=()=>{o.value=!o.value,p()},p=()=>B.get("/api/userInfo/findAll").then(s=>{s.data&&(f.length=0,s.data.forEach(t=>{k.userId&&(d.value=s.data.find(e=>e.id===Number(k.userId)).blogName),t.post.forEach(e=>{const m={userInfoId:t.id,fullName:t.fullName,blogName:t.blogName,postId:e.id,title:e.title,dateTime:e.dateTime,briefDescription:e.briefDescription,fullDescription:e.fullDescription,comments:e.comments};f.push(m),v.value=!0})}))}).catch(s=>{y.push({name:"main"}),console.log("Ошибка получения списка постов")});return V(()=>{p()}),(a,s)=>{const t=q("router-link");return n(),l("div",ee,[o.value?(n(),L(Z,{key:0,onClose:N,userId:b.userId},null,8,["userId"])):x("",!0),d.value?(n(),l("h3",te,u(d.value),1)):(n(),l("h3",se,"Список записей")),r("div",re,[(n(!0),l(R,null,j(h.value,e=>(n(),l("div",{key:e.postId,onClick:m=>_(e.postId),class:"post"},[T(t,{to:{name:"post-by-author",params:{id:e.userInfoId}},onClick:s[0]||(s[0]=$(()=>{},["stop"]))},{default:O(()=>[T(J),z(" "+u(e.fullName),1)]),_:2},1032,["to"]),r("h4",null,u(e.title),1),r("p",null,u(e.briefDescription),1),r("p",null,u(e.fullDescription),1),r("p",null,u(e.dateTime),1),e.comments.length?(n(),l("span",oe," Комментариев: "+u(e.comments.length),1)):(n(),l("span",le," Нет комментариев"))],8,ne))),128))]),b.userId?(n(),l("button",{key:3,onClick:s[1]||(s[1]=e=>o.value=!o.value),class:"post-add"}," создать запись ")):x("",!0)])}}},de=w(ae,[["__scopeId","data-v-302a6916"]]);export{de as P};
