import{_ as O,u as j,b as B,a as F,I as q}from"./IconAvatar-DnJJ8yi9.js";import{u as w,w as H,r as I,o as U,c as f,d as u,e as n,f as k,b as x,v as y,g as o,i as C,t as h,h as N,F as A,j as R,k as M,l as T,m as E,a as S,n as J,p as L,q as z}from"./index-B0BkaikO.js";const G={key:0,class:"error"},K={key:0,class:"error"},Q={key:0,class:"error"},W={class:"date"},X={class:"post__buttons"},Y={__name:"PostChange",props:{post:{type:Object,required:!0}},setup(b){const m=b,g=w(),{handleSubmit:_,errors:d,setValues:r,defineField:a}=j({validateOnMount:!1,validationSchema:{title(e){return e?e.length>50?"Максимальное длина названия - 100 символов":!0:"Введите название"},briefDescription(e){return e?e.length>100?"Максимальное длина - 100 символов":!0:"Введите описание"},fullDescription(e){return e?e.length>255?"Максимальное длина - 100 символов":!0:"Введите описание"}}}),{value:c}=B("title"),{value:p}=B("briefDescription"),{value:i}=B("fullDescription"),D=_(e=>{const t="/api/post",s={id:m.post.id,title:c.value,briefDescription:p.value,fullDescription:i.value};return F.put(t,s).then(v=>{if(v.data)return m.post.dateTime=v.data.dateTime,m.post.title=v.data.title,m.post.briefDescription=v.data.briefDescription,m.post.fullDescription=v.data.fullDescription,v.data}).catch(v=>{console.log("Ошибка обновления записи")})}),V=async()=>{const e=`/api/post/${m.post.id}`;return F.delete(e).then(t=>(g.push({name:"main"}),t)).catch(t=>{console.log("Ошибка удаления записи")})};H(()=>m.post,e=>{if(e){const t=JSON.parse(JSON.stringify(e));r({title:t.title,briefDescription:t.briefDescription,fullDescription:t.fullDescription})}},{immediate:!0,deep:!0});const $=I(null),P=I(null);U(()=>{l(null,"textareaBbiefDescription"),l(null,"textareaFullDescription")});const l=(e,t)=>{if(!t)return;let s;t==="textareaBbiefDescription"?s=$:t==="textareaFullDescription"&&(s=P),s.value&&(s.value.style.height=s.value.scrollHeight+"px")};return(e,t)=>(u(),f("form",null,[t[6]||(t[6]=n("h3",null,"Информация",-1)),n("div",null,[k(n("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>C(c)?c.value=s:null),placeholder:"Заголовок",type:"text"},null,512),[[y,o(c)]]),o(d).title?(u(),f("span",G,h(o(d).title),1)):x("",!0)]),n("div",null,[k(n("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>C(p)?p.value=s:null),onInput:t[2]||(t[2]=s=>l(s,"textareaBbiefDescription")),ref_key:"textareaBbiefDescription",ref:$,placeholder:"Краткое описание"},null,544),[[y,o(p)]]),o(d).briefDescription?(u(),f("span",K,h(o(d).briefDescription),1)):x("",!0)]),n("div",null,[k(n("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>C(i)?i.value=s:null),onInput:t[4]||(t[4]=s=>l(s,"textareaFullDescription")),ref_key:"textareaFullDescription",ref:P,placeholder:"Полное описание"},null,544),[[y,o(i)]]),o(d).fullDescription?(u(),f("span",Q,h(o(d).fullDescription),1)):x("",!0)]),n("div",W,h(b.post.dateTime),1),n("div",X,[n("button",{onClick:t[5]||(t[5]=N((...s)=>o(D)&&o(D)(...s),["prevent"]))},"Обновить"),n("button",{onClick:N(V,["prevent"]),class:"button-delete"},"Удалить")])]))}},Z=O(Y,[["__scopeId","data-v-0f742592"]]),tt={key:0,class:"error"},et={key:0,class:"error"},nt={key:0,class:"error"},ot={__name:"PostAddComment",props:{id:{type:Number,required:!0}},emits:["addComment"],setup(b,{emit:m}){const g=b,_=m,{handleSubmit:d,errors:r,resetForm:a,defineField:c}=j({validateOnMount:!1,validationSchema:{name(l){return l?l.length>50?"Максимальное длина - 50 символов":!0:"Введите ваше имя"},email(l){const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return l?e.test(l)?l.length>100?"Максимальное длина - 100 символов":!0:"Некорректный формат email":"Введите ваш email"},comment(l){return l?l.length>255?"Максимальное длина - 255 символов":!0:"Введите комментарий"}}}),[p]=c("name"),[i]=c("email"),[D]=c("comment"),V=I(null),$=(l,e)=>{let t;t=V,t.value&&(t.value.style.height="auto",t.value.style.height=t.value.scrollHeight+"px")},P=d(l=>{const e="/api/comment",t={userInfo:p.value,email:i.value,textComment:D.value},s={params:{postId:g.id}};return F.post(e,t,s).then(v=>{if(v.data)return a({values:{name:"",email:"",comment:""}}),_("addComment"),v.data}).catch(v=>{console.log("Ошибка при добавлении комментария")})});return U(()=>{$()}),(l,e)=>(u(),f("form",{onSubmit:e[5]||(e[5]=N((...t)=>l.updatePost&&l.updatePost(...t),["prevent"])),action:""},[e[6]||(e[6]=n("h3",null,"Добавить комментарий",-1)),n("div",null,[k(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>C(p)?p.value=t:null),placeholder:"Имя",type:"text"},null,512),[[y,o(p)]]),o(r).name?(u(),f("span",tt,h(o(r).name),1)):x("",!0)]),n("div",null,[k(n("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>C(i)?i.value=t:null),placeholder:"Email",type:"text"},null,512),[[y,o(i)]]),o(r).email?(u(),f("span",et,h(o(r).email),1)):x("",!0)]),n("div",null,[k(n("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>C(D)?D.value=t:null),onInput:e[3]||(e[3]=t=>$()),ref_key:"textareaComment",ref:V,placeholder:"Комментарий"},null,544),[[y,o(D)]]),o(r).comment?(u(),f("span",nt,h(o(r).comment),1)):x("",!0)]),n("button",{onClick:e[4]||(e[4]=(...t)=>o(P)&&o(P)(...t))},"Отправить")],32))}},st={class:""},rt={class:"comments"},lt=["onClick"],it={class:"comment__email"},at={__name:"PostComments",props:{comments:{type:null,required:!0}},emits:["deleteComment"],setup(b,{emit:m}){const g=m,_=async d=>{const r=`/api/comment/${d}`;return F.delete(r).then(a=>{if(g("deleteComment"),a.data)return a.data}).catch(a=>{console.log("Ошибка удаления комментария")})};return(d,r)=>(u(),f("div",st,[r[1]||(r[1]=n("h3",null,"Комментарии",-1)),n("div",rt,[(u(!0),f(A,null,R(b.comments,a=>(u(),f("div",{onClick:c=>_(a.id),key:a.id,class:"comment"},[r[0]||(r[0]=n("button",{class:"close close-mini"},"×",-1)),n("p",null,[M(q),T(" "+h(a.userInfo),1)]),n("p",it,h(a.email),1),n("p",null,h(a.textComment),1)],8,lt))),128))])]))}},ut=O(at,[["__scopeId","data-v-1e6911cb"]]),dt={class:"wrapper"},mt={class:"post"},ct={__name:"Post",setup(b){const m=z(),g=w(),_=E({}),d=I("0"),r=I(!1),a=async()=>{const p=`/api/post/${m.params.id}`;return F.get(p).then(i=>{if(Object.assign(_,i.data),d.value=i.data.comments.length,r.value=!0,i.data)return i.data}).catch(i=>{g.push({name:"main"}),console.log("Ошибка получения поста по id")})},c=()=>{a()};return U(()=>{a()}),(p,i)=>{const D=L("router-link");return u(),f("div",dt,[n("div",mt,[M(D,{to:"/",class:"close"},{default:J(()=>i[0]||(i[0]=[T(" × ")])),_:1,__:[0]}),r.value?(u(),S(Z,{key:0,post:_},null,8,["post"])):x("",!0),d.value?(u(),S(ut,{key:1,comments:_.comments,onDeleteComment:c},null,8,["comments"])):x("",!0),r.value?(u(),S(ot,{key:2,id:_.id,onAddComment:c},null,8,["id"])):x("",!0)])])}}},vt=O(ct,[["__scopeId","data-v-7a1724b0"]]);export{vt as default};
